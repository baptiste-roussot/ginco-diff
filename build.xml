<?xml version="1.0" encoding="UTF-8"?>
<!-- 
This software is governed by the CeCILL-B license under French law and
abiding by the rules of distribution of free software. You can use,
modify and/or redistribute the software under the terms of the CeCILL-B
license as circulated by CEA, CNRS and INRIA at the following URL
"http://www.cecill.info".

As a counterpart to the access to the source code and rights to copy,
modify and redistribute granted by the license, users are provided only
with a limited warranty and the software's author, the holder of the
economic rights, and the successive licensors have only limited
liability.

In this respect, the user's attention is drawn to the risks associated
with loading, using, modifying and/or developing or reproducing the
software by the user in light of its specific status of free software,
that may mean that it is complicated to manipulate, and that also
therefore means that it is reserved for developers and experienced
professionals having in-depth computer knowledge. Users are therefore
encouraged to load and test the software's suitability as regards their
requirements in conditions enabling the security of their systems and/or
data to be ensured and, more generally, to use and operate it in the
same conditions as regards security.

The fact that you are presently reading this means that you have had
knowledge of the CeCILL-B license and that you accept its terms.
-->

<!--
     General purpose build script for web applications and web services,
     including enhanced support for deploying directly to a Tomcat based
     server.

     This build script assumes that the source code of your web application
     is organized into the following subdirectories underneath the source
     code directory from which you execute the build script:

        docs                 Static documentation files to be copied to
                             the "docs" subdirectory of your distribution.

        src                  Java source code (and associated resource files)
                             to be compiled to the "WEB-INF/classes"
                             subdirectory of your web applicaiton.

        web                  Static HTML, JSP, and other content (such as
                             image files), including the WEB-INF subdirectory
                             and its configuration file contents.

     $Id: build.xml,v 1.1 2012/03/27 13:22:59 SWORDGROUP+ebarthuet Exp $
-->


<!--
  A "project" describes a set of targets that may be requested
  when Ant is executed.  The "default" attribute defines the
  target which is executed if no specific target is requested,
  and the "basedir" attribute defines the current working directory
  from which Ant executes the requested task.  This is normally
  set to the current working directory.
-->

<project name="thesaurus" default="dist" basedir=".">

  <!-- ================ Property Definitions ============================== -->

  <!--
    Each of the following properties are used in the build script.
    Values for these properties are set by the first place they are
    defined, from the following list:

     * Definitions on the "ant" command line (ant -Dfoo=bar compile).

     * Definitions from a "build.properties" file in the top level
       source directory of this application.

     * Definitions from a "foo-build.properties" file in the developer's
       home directory.

     * Default definitions in this build.xml file.

    You will note below that property values can be composed based on
    the contents of previously defined properties.  This is a powerful
    technique that helps you minimize the number of changes required
    when your development environment is modified.  Note that property
    composition is allowed within "build.properties" files as well as
    in the "build.xml" script.
   -->

  <property file="${user.home}/thesaurus-build.properties"/>
  <property file="build.properties"/>


  <!-- ================ File and Directory Names ========================== -->

  <!--
    These properties generally define file and directory names (or paths)
    that affect where the build process stores its outputs.

    app.name            Base name of this application, used to
                        construct filenames and directories.
                        Defaults to "myapp".

    app.path            Context path to which this application should be
                        deployed (defaults to "/" plus the value of the
                        "app.name" property).

    app.version         Version number of this iteration of the application.

    build.home          The directory into which the "prepare" and
                        "compile" targets will generate their output.
                        Defaults to "build".

    dist.home           The name of the base directory in which
                        distribution files are created.
                        Defaults to "dist".
   -->

  <property name="app.name"             value="${ant.project.name}"/>
  <property name="app.version"          value="12.12.0"/>
  <property name="app.path"             value="/${app.name}"/>
  <property name="app.long.name"
            value="Application pour l'indexation de vocabulaires au format SKOS"/>

  <property name="build.home"           location="${basedir}/build"/>
  <property name="dist.home"            location="${basedir}/dist"/>

  <property name="conf.home"            location="${basedir}/conf"/>
  <property name="src.home"             location="${basedir}/src"/>
  <property name="web.home"             location="${basedir}/web"/>

  <property name="lib.home"             location="${basedir}/lib"/>
  <property name="build.lib.home"       location="${lib.home}"/>
  <property name="deploy.lib.home"      location="${lib.home}/deploy"/>
  <property name="run.lib.home"         location="${web.home}/WEB-INF/lib"/>

  <property name="docs.dir"             location="${dist.home}/docs"/>
  <property name="web-inf.dir"          location="${build.home}/WEB-INF"/>
  <property name="classes.dir"          location="${web-inf.dir}/classes"/>

  <property name="app.docbase"          value="${app.name}"/>
  <property name="war.name"             value="${app.docbase}.war"/>
  <property name="war.path"             location="${dist.home}/${war.name}"/>
  <property name="war.url"              value="file:${war.path}"/>


  <!-- ================ Compilation Control Options ======================= -->

  <!--
    These properties control option settings on the Javac compiler when it
    is invoked using the <javac> task.
     - compile.debug        Should compilation include the debug option?
     - compile.deprecation  Should compilation include the deprecation option?
     - compile.optimize     Should compilation include the optimize option?
   -->

  <property name="compile.debug"        value="true"/>
  <property name="compile.deprecation"  value="false"/>
  <property name="compile.optimize"     value="false"/>
  <property name="compile.target"       value="1.6"/>
  <property name="compile.compiler"     value="javac1.6"/>
  <property name="compile.source"       value="1.6"/>
  <property name="compile.executable"   value="C:\Program Files\Java\jdk6\bin\javac"/>
  <property name="compile.fork"         value="true"/>
  <property name="compile.encoding"     value="UTF-8"/>

  <!-- ================ Compilation Classpath ============================= -->

  <!--
    Rather than relying on the CLASSPATH environment variable, Ant includes
    features that makes it easy to dynamically construct the classpath you
    need for each compilation.  The example below constructs the compile
    classpath to include the servlet.jar file, as well as the other components
    that Tomcat makes available to web applications automatically, plus
    anything that you explicitly added.
   -->

  <path id="runtime.classpath">
    <!-- Include all JAR files that will be included in webapp WAR -->
    <fileset dir="${run.lib.home}">
      <include name="**/*.jar"/>
    </fileset>
  </path>

  <path id="compile.classpath">
    <!-- Runtime libraries -->
    <path refid="runtime.classpath"/>
    <!-- Buildtime-only libraries -->
    <fileset dir="${build.lib.home}">
      <include name="**/*.jar"/>
    </fileset>
  </path>



  <!-- ================ Filter sets for file copy ========================= -->

  <filterset id="webapp.param.filters">
    <filter token="app.name"              value="${app.name}"/>
    <filter token="app.long.name"         value="${app.long.name}"/>
    <filter token="app.version"           value="${app.version}"/>
    <filter token="app.path"              value="${app.path}"/>
    <filter token="app.docbase"           value="${app.docbase}"/>
  </filterset>


  <!-- ================ All Target ======================================== -->

  <!--
    The "all" target is a shortcut for running the "clean" target followed
    by the "dist" target (to force a complete recompile and packaging).
   -->

  <target name="all" depends="clean,dist"
   description="Cleans build and dist directories, then rebuilds distribution"/>


  <!-- ================ Clean Target ====================================== -->

  <!--
    The "clean" target deletes any previous "build" and "dist" directories,
    so that you can be ensured the application can be built from scratch.
   -->

  <target name="clean" depends="init"
          description="Deletes build and dist directories">
    <delete dir="${build.home}"/>
    <delete dir="${dist.home}"/>
  </target>


  <!-- ================ Prepare Target ==================================== -->

  <!--
    The "prepare" target is used to create the "build" destination directory,
    and copy the static contents of your web application to it.  If you need
    to copy static files from external dependencies, you can customize the
    contents of this task.

    Normally, this task is executed indirectly when needed.
   -->

  <target name="init">
    <tstamp/>
  </target>

  <target name="prepare" depends="init">
    <!-- Create build directories as needed -->
    <mkdir dir="${build.home}"/>
    <!-- Create compilation target directory -->
    <mkdir dir="${classes.dir}"/>
  </target>


  <!-- ================ Compile Target ==================================== -->

  <!--
    The "compile" target transforms source files (from your "src" directory)
    into object files in the appropriate location in the build directory.
    This example assumes that you will be including your classes in an
    unpacked directory hierarchy under "/WEB-INF/classes".
   -->

  <target name="compile" depends="prepare"
                         description="Compiles Java sources">
    <!-- Compile Java classes as necessary -->
    <javac srcdir="${src.home}"
          destdir="${classes.dir}"
            debug="${compile.debug}"
      deprecation="${compile.deprecation}"
         optimize="${compile.optimize}"
    	   target="${compile.target}"
    	 compiler="${compile.compiler}"
    	   source="${compile.source}"
       executable="${compile.executable}"
    	     fork="${compile.fork}"
    	 encoding="${compile.encoding}">
      <classpath refid="compile.classpath"/>
    </javac>
    <!-- Copy application resources -->
    <copy todir="${classes.dir}" includeEmptyDirs="false"
                                 preservelastmodified="true">
      <fileset dir="${src.home}" excludes="**/*.java,**/*.html,**/.*"/>
    </copy>
  </target>


  <!-- ================ Dist Target ======================================= -->

  <!--
    The "dist" target creates the web application configuration files
    and makes then ready for deployment.
   -->

  <target name="prepare-dist" depends="prepare">
    <!-- Copy web application page templates and resources -->
    <copy todir="${build.home}" includeEmptyDirs="false"
                                preservelastmodified="true">
      <fileset dir="${web.home}" excludes="**/.*"/>
    </copy>
    <!-- Copy web application static content and context definition -->
    <copy todir="${web-inf.dir}" encoding="UTF-8" preservelastmodified="true">
      <fileset dir="${web.home}" includes="web.xml"/>
      <filterset refid="webapp.param.filters"/>
    </copy>
    <!-- Create build directories as needed -->
    <mkdir dir="${dist.home}"/>
  </target>

  <!--
    The "dist" target creates a binary distribution of your application
    in a directory structure ready to be archived in a tar.gz or zip file.
    Note that this target depends on two other targets:
      - "compile" to build the the entire web application (including
        external dependencies);
      - "prepare-dist" to prepare web application configuration for
        deployement.
   -->

  <target name="dist" depends="compile,prepare-dist"
                      description="Create binary distribution">
    <!-- Create application JAR file -->
    <jar jarfile="${war.path}"
         basedir="${build.home}"/>
  </target>


  <!-- ================ Helper Targets ==================================== -->

  <!--
    The "debug" target lists the build configuration.
   -->

  <target name="debug" depends="init"
                       description="Lists the build configuration">

    <echo message="Build properties:"/>
    <echo message=""/>
    <echo message=" - Application configuration:"/>
    <echo message="   - app.name            = ${app.name}"/>
    <echo message="   - app.long.name       = ${app.long.name}"/>
    <echo message="   - app.version         = ${app.version}"/>
    <echo message=""/>
    <echo message="   - war.name            = ${war.name}"/>
    <echo message="   - app.path            = ${app.path}"/>
    <echo message="   - app.docbase         = ${app.docbase}"/>
    <echo message=""/>
    <echo message=" - Generation options:"/>
    <echo message="   - compile.debug       = ${compile.debug}"/>
    <echo message="   - compile.deprecation = ${compile.deprecation}"/>
    <echo message="   - compile.optimize    = ${compile.optimize}"/>
    <echo message=""/>
    <echo message=" - Build environment:"/>
    <echo message="   - basedir             = ${basedir}"/>
    <echo message="   - build.home          = ${build.home}"/>
    <echo message="   - dist.home           = ${dist.home}"/>
    <echo message="   - user.home           = ${user.home}"/>
    <echo message=""/>

  </target>

</project>

